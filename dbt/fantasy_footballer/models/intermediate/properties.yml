version: 2

models:

  - name: int__clutch_records
    columns:
      - name: team_id
        data_type: int
        data_tests:
          - not_null
      - name: team_year_id
        data_type: varchar
        data_tests:
          - not_null
      - name: year
        data_type: int
        data_tests:
          - not_null
      - name: season_points_for
        data_type: double
        data_tests:
          - not_null
      - name: season_points_against
        data_type: double
        data_tests:
          - not_null
      - name: record
        data_type: varchar
        data_tests:
          - not_null

  - name: int__current_season_year
    description: >
      Single-row reference table containing the most recent season year available in the data.
      Used as a lookup for filtering and reporting on current season data across the warehouse.
    columns:
      - name: current_season_year
        description: The maximum (most recent) season year present in the owner_team_year_map
        data_type: int
        data_tests:
          - not_null

  - name: int__matchup_week_playoff_map
    columns:
      - name: year
        data_type: int
        data_tests:
          - not_null
      - name: matchup_week
        data_type: int
        data_tests:
          - not_null
      - name: week
        data_type: int
        data_tests:
          - not_null
      - name: is_playoff
        data_type: boolean
        data_tests:
          - not_null

  - name: int__owner_team_map
    description: >
      Deduplicated mapping of owners to teams across all seasons. Provides a historical view
      of which teams each owner has controlled, collapsing year-specific records into unique
      owner-team relationships. Useful for identifying franchise ownership history.

    columns:
      - name: owner_id
        description: Unique identifier for the owner
        data_type: integer
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('int__owner_team_year_map')
                field: owner_id
      - name: owner_name
        description: Canonical name of the owner
        data_type: varchar
        data_tests:
          - not_null
      - name: team_id
        description: Unique identifier for the team
        data_type: int
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('int__owner_team_year_map')
                field: team_id

  - name: int__owner_team_year_map
    description: >
      Mapping of owners to their teams by year. Links team records to owner profiles through
      display names, creating a bridge table that tracks which owner controlled which team
      in each season. Uses distinct to handle any duplicate mappings from the source data.

    columns:
      - name: owner_id
        description: Unique identifier for the owner
        data_type: integer
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg__owner_display_names')
                field: owner_id
      - name: owner_name
        description: Canonical name of the owner
        data_type: varchar
        data_tests:
          - not_null
      - name: owner_year_id
        description: Composite key combining owner_id and year (format 'owner_id_year')
        data_type: varchar
        data_tests:
          - not_null
      - name: team_id
        description: Unique identifier for the team
        data_type: int
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('base_s001__teams')
                field: team_id
      - name: team_year_id
        description: Composite key combining team_id and year (format 'team_id_year')
        data_type: varchar
        data_tests:
          - not_null
          - unique
      - name: team_name
        description: Name of the team for this season
        data_type: varchar
        data_tests:
          - not_null
      - name: year
        description: Season year
        data_type: int
        data_tests:
          - not_null

  - name: int__shotguns
    description: Model identifying weeks where a team scored under 100 points or had the lowest score in the league (shotgun weeks)
    columns:
      - name: team_id
        description: Unique identifier for the team owner
        data_type: int
      - name: team_year_id
        description: Unique identifier for the team owner
        data_type: varchar
      - name: team_week_id
        description: Unique identifier for the owner's matchup record
        data_type: varchar
        tests:
          - not_null
      - name: year
        description: Season year
        data_type: integer
        tests:
          - not_null
      - name: week
        description: Week number of the matchup
        data_type: integer
        tests:
          - not_null
      - name: is_shotgun
        description: Boolean flag indicating if the team had a shotgun week (scored under 100 points or had the lowest score in the league that week)
        data_type: boolean
        tests:
          - not_null

  - name: int__weeks_played_by_year
    columns:
      - name: year
        description: Unique identifier for the team owner
        data_type: int
      - name: weeks_played
        description: Unique identifier for the team owner
        data_type: int